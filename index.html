<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Letter Race 3D</title>

<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;background:#0b0f14;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
#ui{position:fixed;left:12px;right:12px;top:10px;display:flex;justify-content:space-between;pointer-events:none}
.pill{pointer-events:auto;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.14);color:#fff;padding:10px 12px;border-radius:14px;display:flex;gap:10px}
#bigLetter{width:46px;height:46px;border-radius:12px;background:rgba(255,255,255,.16);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:900}
#help{position:fixed;left:12px;right:12px;bottom:12px;display:flex;justify-content:space-between;pointer-events:none}
.btn{pointer-events:auto;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.14);color:#fff;padding:14px 16px;border-radius:16px;font-weight:800;min-width:120px;text-align:center}
#overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:radial-gradient(ellipse at center,rgba(20,30,45,.92),rgba(5,7,10,.96));color:#fff}
#card{width:min(760px,calc(100% - 24px));background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);border-radius:18px;padding:18px}
</style>
</head>
<body>

<div id="overlay">
<div id="card">
<h1>Letter Race 3D</h1>
<p>Pak de juiste kleine letter. Weg draait zoals een echte race.</p>
<button id="startBtn">Start</button>
</div>
</div>

<div id="ui">
<div class="pill"><div id="bigLetter">b</div><div>Doelletter</div></div>
<div class="pill"><div id="score">Score: 0</div></div>
</div>

<div id="help">
<div class="btn" id="leftBtn">Links</div>
<div class="btn" id="rightBtn">Rechts</div>
</div>

<script type="module">
import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";

let scene,camera,renderer;
let car,lane=1;
const laneOffsets=[-2.2,0,2.2];
const carZ=2.2;

let speed=.028;
let score=0;

const activeLetters=["b","g","v","m","z","h","k","l","s","w"];
let target="b";
let pickups=[];

let roadMesh,roadGeom,roadTexture;

const ROAD={
width:12,
length:260,
segZ:260,
phase:0,
amp1:3.4,
per1:210,
amp2:1.9,
per2:95,
blockAmp:1.8,
blockPer:160,
bankMax:.22
};

const uiBig=document.getElementById("bigLetter");
const uiScore=document.getElementById("score");

function smoothStep(t){return t*t*(3-2*t)}
function blockWave(z,p){const x=((z+ROAD.phase)/p)%1;const a=smoothStep(Math.min(1,x*2));const b=smoothStep(Math.max(0,(x-.5)*2));return(a-b)*2-1}

function trackOffsetX(z){
return ROAD.amp1*Math.sin(((z+ROAD.phase)/ROAD.per1)*Math.PI*2)
+ROAD.amp2*Math.sin(((z+ROAD.phase)/ROAD.per2)*Math.PI*2)
+ROAD.blockAmp*blockWave(z,ROAD.blockPer)
}

function trackDeriv(z){const dz=.25;return(trackOffsetX(z+dz)-trackOffsetX(z-dz))/(2*dz)}
function trackBank(z){return THREE.MathUtils.clamp(trackDeriv(z)*.18,-ROAD.bankMax,ROAD.bankMax)}

function laneXAtZ(lane,z){return trackOffsetX(z)+laneOffsets[lane]}

function buildRoadTexture(){
const c=document.createElement("canvas");c.width=512;c.height=1024;
const ctx=c.getContext("2d");
ctx.fillStyle="#111a24";ctx.fillRect(0,0,c.width,c.height);
ctx.fillStyle="#fff";for(let y=0;y<c.height;y+=120)ctx.fillRect(c.width/2-4,y+20,8,60);
const tex=new THREE.CanvasTexture(c);tex.wrapT=THREE.RepeatWrapping;tex.repeat.set(1,6);return tex
}

function cacheRoadBase(){
const pos=roadGeom.attributes.position;
const baseX=new Float32Array(pos.count);
const baseZ=new Float32Array(pos.count);
for(let i=0;i<pos.count;i++){const ix=i*3;baseX[i]=pos.array[ix];baseZ[i]=pos.array[ix+2]}
roadGeom.userData.baseX=baseX;roadGeom.userData.baseZ=baseZ
}

function bendRoad(){
const pos=roadGeom.attributes.position;const arr=pos.array;
const baseX=roadGeom.userData.baseX;const baseZ=roadGeom.userData.baseZ;
for(let i=0;i<pos.count;i++){
const ix=i*3;
const zWorld=baseZ[i]+roadMesh.position.z;
const off=trackOffsetX(zWorld);
const bank=trackBank(zWorld);
const side=baseX[i]/(ROAD.width*.5);
arr[ix]=baseX[i]+off;
arr[ix+1]=side*Math.sin(bank)*.22
}
pos.needsUpdate=true;roadGeom.computeVertexNormals()
}

function buildRoad(){
roadTexture=buildRoadTexture();
roadGeom=new THREE.PlaneGeometry(ROAD.width,ROAD.length,1,ROAD.segZ);
roadGeom.rotateX(-Math.PI/2);
cacheRoadBase();
const mat=new THREE.MeshStandardMaterial({map:roadTexture});
roadMesh=new THREE.Mesh(roadGeom,mat);
roadMesh.position.z=-ROAD.length*.55;
scene.add(roadMesh);
bendRoad()
}

function makeLetter(letter){
const canvas=document.createElement("canvas");canvas.width=256;canvas.height=256;
const ctx=canvas.getContext("2d");
ctx.fillStyle="rgba(255,255,255,.2)";ctx.fillRect(0,0,256,256);
ctx.fillStyle="#fff";ctx.font="bold 140px sans-serif";ctx.textAlign="center";ctx.textBaseline="middle";
ctx.fillText(letter,128,140);
const tex=new THREE.CanvasTexture(canvas);
const mat=new THREE.SpriteMaterial({map:tex});
const sprite=new THREE.Sprite(mat);
sprite.scale.set(1.3,1.3,1);
return sprite
}

function createPickup(letter,lane,z){
const g=new THREE.Group();
const box=new THREE.Mesh(new THREE.BoxGeometry(1,.7,1),new THREE.MeshStandardMaterial({color:0x9aa6b2}));
box.position.y=.35;g.add(box);
const spr=makeLetter(letter);spr.position.y=1;g.add(spr);
g.position.set(laneXAtZ(lane,z),0,z);
g.userData={letter,lane};
scene.add(g);pickups.push(g)
}

function spawnSet(){
const z=-40-Math.random()*20;
const correct=Math.floor(Math.random()*3);
createPickup(target,correct,z);
const others=activeLetters.filter(l=>l!==target);
for(let i=0;i<3;i++)if(i!==correct)createPickup(others[Math.floor(Math.random()*others.length)],i,z)
}

function setTarget(l){target=l;uiBig.textContent=l}
function pickNew(){setTarget(activeLetters[Math.floor(Math.random()*activeLetters.length)])}

function setup(){
scene=new THREE.Scene();
camera=new THREE.OrthographicCamera(-10,10,10,-10,.1,800);
camera.position.set(0,16,12);camera.lookAt(0,0,-18);
renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.HemisphereLight(0xffffff,0x222,1));
const d=new THREE.DirectionalLight(0xffffff,1);d.position.set(5,10,5);scene.add(d);

buildRoad();

const texLoader=new THREE.TextureLoader();
const tex={s:texLoader.load("./car_straight.png"),l:texLoader.load("./car_left.png"),r:texLoader.load("./car_right.png")};

const group=new THREE.Group();
const plane=new THREE.Mesh(new THREE.PlaneGeometry(3,3),new THREE.MeshBasicMaterial({map:tex.s,transparent:true}));
plane.rotation.x=-.2;plane.position.y=1.2;group.add(plane);
car=group;scene.add(car);
car.userData={plane,tex,blink:0};

setTarget(activeLetters[0]);
for(let i=0;i<3;i++)spawnSet()
}

function moveLane(dir){
lane=Math.max(0,Math.min(2,lane+dir));
car.userData.plane.material.map=dir<0?car.userData.tex.l:car.userData.tex.r;
car.userData.blink=25
}

function tick(){
ROAD.phase+=speed*10;
roadTexture.offset.y=(roadTexture.offset.y+speed*.06)%1;
bendRoad();

const desiredX=laneXAtZ(lane,carZ);
car.position.x+=(desiredX-car.position.x)*.1;

const bank=trackBank(carZ);
car.rotation.z+=(bank*.7-car.rotation.z)*.1;

if(car.userData.blink>0){car.userData.blink--;if(!car.userData.blink)car.userData.plane.material.map=car.userData.tex.s}

for(const p of pickups){
p.position.z+=speed*10;
p.position.x=laneXAtZ(p.userData.lane,p.position.z);
if(Math.abs(p.position.z-carZ)<1&&Math.abs(p.position.x-car.position.x)<1){
if(p.userData.letter===target){score++;pickNew()}
uiScore.textContent="Score: "+score;
scene.remove(p);p.hit=true
}}
pickups=pickups.filter(p=>!p.hit);
while(pickups.length<9)spawnSet();

renderer.render(scene,camera);
requestAnimationFrame(tick)
}

document.getElementById("startBtn").onclick=()=>{
setup();document.getElementById("overlay").style.display="none";tick()
};

document.getElementById("leftBtn").onclick=()=>moveLane(-1);
document.getElementById("rightBtn").onclick=()=>moveLane(1);
window.addEventListener("pointerdown",e=>{const x=e.clientX/window.innerWidth;if(x<.4)moveLane(-1);if(x>.6)moveLane(1)})
</script>
</body>
</html>