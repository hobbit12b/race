<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Letter Race</title>
<style>
  html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#111; font-family: Arial, sans-serif; }
  canvas { display:block; }
  #ui {
    position:absolute; top:12px; left:12px; color:#fff;
    font-size:18px; background:rgba(0,0,0,.35);
    padding:10px 12px; border-radius:12px;
  }
</style>
</head>
<body>

<div id="ui">Energie: <span id="energy">100</span></div>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

function resize(){ canvas.width=innerWidth; canvas.height=innerHeight }
addEventListener("resize",resize); resize();

const uiEnergy=document.getElementById("energy");

function loadImg(src){ const i=new Image(); i.src=src; return i; }
const carStraight=loadImg("car_straight.png");
const carLeft=loadImg("car_left.png");
const carRight=loadImg("car_right.png");

function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
function mod(n,m){ return ((n%m)+m)%m; }

let energy=100;
let roadScroll=0;

const letters="aeioumkstprln".split("");
const items=[];

const state={ lane:1, lastTime:performance.now() };

const car={ x:canvas.width/2, y:canvas.height*.78, tilt:0, steerDx:0, w:150, h:90 };

function roadWidthAt(y){
  const t=clamp(y/canvas.height,0,1);
  return canvas.width*.3 + (canvas.width*.9-canvas.width*.3)*(t**1.6);
}
function roadCenterXAt(y){
  const t=clamp(y/canvas.height,0,1);
  const slow=Math.sin(roadScroll/680)*(canvas.width*.035);
  return canvas.width/2 + slow*(1-t);
}
function roadEdgesAt(y){
  const w=roadWidthAt(y);
  const cx=roadCenterXAt(y);
  return {left:cx-w/2,right:cx+w/2,cx,w};
}

function laneX(lane,y){
  const e=roadEdgesAt(y);
  const laneWidth=e.w/3;
  return e.left + laneWidth*(lane+.5);
}

function drawGrass(){
  ctx.fillStyle="#3aa64b";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // subtiele dieptevlekken
  for(let i=0;i<12;i++){
    const x=(i*canvas.width/12)+(Math.sin(roadScroll/200+i)*20);
    const y=(i*140 + roadScroll*1.3)% (canvas.height+200)-100;
    ctx.fillStyle="rgba(0,0,0,0.05)";
    ctx.beginPath();
    ctx.ellipse(x,y,120,60,0,0,Math.PI*2);
    ctx.fill();
  }
}

function drawRoad(){
  const pts=[];
  for(let y=0;y<=canvas.height+26;y+=26){
    const e=roadEdgesAt(y);
    pts.push({y,left:e.left,right:e.right,cx:e.cx,w:e.w});
  }

  ctx.beginPath();
  ctx.moveTo(pts[0].left,pts[0].y);
  for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].left,pts[i].y);
  for(let i=pts.length-1;i>=0;i--) ctx.lineTo(pts[i].right,pts[i].y);
  ctx.closePath();
  ctx.fillStyle="#505050";
  ctx.fill();

  // middenstrepen
  const dashScroll=roadScroll%260;
  for(const p of pts){
    const t=clamp(p.y/canvas.height,0,1);
    const phase=mod(p.y-dashScroll,260);
    if(phase>90) continue;
    ctx.strokeStyle="rgba(255,245,190,0.75)";
    ctx.lineWidth=12+t*10;
    ctx.beginPath();
    ctx.moveTo(p.cx,p.y);
    ctx.lineTo(p.cx,p.y+28+t*48);
    ctx.stroke();
  }
}

function drawCar(){
  const base=Math.min(canvas.width,canvas.height);
  const w=Math.max(160,base*.25); // +10%
  const h=w*.62;
  car.w=w; car.h=h;

  const img=car.steerDx<-18?carLeft:car.steerDx>18?carRight:carStraight;

  ctx.save();
  ctx.translate(car.x,car.y);
  ctx.rotate(car.tilt*.4);

  ctx.fillStyle="rgba(0,0,0,.22)";
  ctx.beginPath();
  ctx.ellipse(0,h*.36,w*.34,h*.22,0,0,Math.PI*2);
  ctx.fill();

  if(img.complete) ctx.drawImage(img,-w/2,-h/2,w,h);
  ctx.restore();
}

function drawItem(it){
  const t=clamp(it.y/canvas.height,0,1);
  const size=30+t*90;
  ctx.fillStyle="rgba(255,220,120,.95)";
  ctx.fillRect(it.x-size/2,it.y-size/2,size,size);

  ctx.fillStyle="#111";
  ctx.font=`700 ${Math.floor(16+t*44)}px Arial`;
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText(it.letter,it.x,it.y);
}

function spawnLetter(){
  if(items.length>2) return;
  const lane=Math.floor(Math.random()*3);
  items.push({lane,y:-60,letter:letters[Math.floor(Math.random()*letters.length)],vy:7});
}

let spawnTimer=0;

function update(dt){
  energy-=0.02*dt;
  uiEnergy.textContent=Math.floor(energy);

  roadScroll+=8*dt;

  // doel x op basis van lane
  const targetX=laneX(state.lane,car.y);
  const dx=targetX-car.x;
  car.steerDx=dx;
  car.x+=dx*(.08*dt);
  car.tilt+=(clamp(dx/(canvas.width*.8),-.25,.25)-car.tilt)*(.08*dt);

  spawnTimer+=dt;
  if(spawnTimer>150){ spawnTimer=0; spawnLetter(); }

  for(let i=items.length-1;i>=0;i--){
    const it=items[i];
    it.y+=it.vy*dt;
    it.x=laneX(it.lane,it.y);

    if(Math.abs(it.x-car.x)<car.w*.36 && Math.abs(it.y-car.y)<car.h*.36){
      energy=Math.min(140,energy+10);
      items.splice(i,1);
      continue;
    }
    if(it.y>canvas.height+120) items.splice(i,1);
  }
}

function draw(){
  drawGrass();
  drawRoad();
  items.forEach(drawItem);
  drawCar();
}

function loop(now){
  const dt=Math.min(3,(now-state.lastTime)/(1000/60));
  state.lastTime=now;
  if(energy>0) update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// tikbesturing
canvas.addEventListener("pointerdown",e=>{
  const x=e.clientX;
  if(x<canvas.width/3) state.lane=0;
  else if(x<canvas.width*2/3) state.lane=1;
  else state.lane=2;
});
</script>
</body>
</html>